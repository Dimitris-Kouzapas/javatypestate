package demos.redis.jediswrapper;

public class Test2 {
	public static void main (String[] args) {
	   new Test2().run();
	}
	
	void run () {
	   JedisWrapper jedis = new JedisWrapper();
	   jedis.WATCH(new String[]{ "name" });
	   jedis.WATCH(new String[]{ "address" });
	   doTransaction(jedis);
	}

    // These methods seem to have a useful type inferred. We don't seem to allow
    // inheritance, which simplifies things.
    void prepareWatches (JedisWrapper jedis) {
	   jedis.WATCH(new String[]{ "name" });
	   jedis.WATCH(new String[]{ "address" });
    }

	void doTransaction (JedisWrapper jedis) {
	   jedis.MULTI();
	   switch (jedis.EXEC().getEnum()) {
	   case Result.OK:
	      break;
	   case Result.FAIL:
	      discardTransaction(jedis);
	      break;
	   }
	}

    void discardTransaction (JedisWrapper jedis) {
    	jedis.DISCARD();
    }
}
