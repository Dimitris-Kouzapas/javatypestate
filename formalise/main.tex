\documentclass[a4paper]{llncs}
%\documentclass[a4paper]{article}
\usepackage{comment}
\usepackage{xspace}
\usepackage{amsfonts}




\input{macros}

\newcommand{\class}{\ensuremath{\mathtt{class}\ }}
\newcommand{\enum}{\ensuremath{\mathtt{enum}\ }}
\newcommand{\Null}{\ensuremath{\mathtt{Null}\ }}
\newcommand{\nul}{\ensuremath{\mathtt{null}\ }}
\newcommand{\this}{\ensuremath{\mathtt{this}\ }}
\newcommand{\brk}{\ensuremath{\mathtt{break}\ }}
\newcommand{\continue}{\ensuremath{\mathtt{continue}\ }}
\newcommand{\return}{\ensuremath{\mathtt{return}\ }}
\newcommand{\lab}[1]{\ensuremath{\mathtt{#1:}\ }}
\newcommand{\ctype}[2]{#1[#2]}
\newcommand{\base}{\ensuremath{\mathtt{base}\ }}
\newcommand{\method}[4]{#1\ #2(#3)\set{#4}}
\newcommand{\vdecl}[2]{#1\ #2}
\newcommand{\mcall}[2]{#1(#2)}
\newcommand{\newo}[1]{\ensuremath{\mathtt{new}\ #1()}}
\newcommand{\switch}[2]{\ensuremath{\mathtt{switch}(#1)\set{#2}}}
\newcommand{\while}[2]{\ensuremath{\mathtt{while}(#1)\set{#2}}}

\newcommand{\econtext}[2]{\mathcal{#1}[#2]}

%%%%%%%%%%
%%%%%%%%%%
\title{Formalise Java Typestate}

\author{}

\pagestyle{plain}

%%% 
\begin{document}

	\maketitle

	Syntax:
\[
	\begin{array}{lrcl}
		&D &\bnfis& \class C \set{S; \vect{F}; \vect{M}} \bnfbar \enum E \set{\vec{l}}\\
		\textrm{(Types)} & T &\bnfis& \Null \bnfbar \ctype{C}{S}\\% \bnfbar \base\\
		\textrm{(Fields)} &F &\bnfis& \vdecl{T}{f}\\		
		\textrm{(Local)} &V &\bnfis& \vdecl{T}{x}\\
		\textrm{(Methods)} &M &\bnfis& \method{T}{m}{T x}{e}\\
		\textrm{(Values)} &v& \bnfis& \nul \bnfbar l\\
		\textrm{(Paths)}  &r& \bnfis & \this.f \bnfbar x\\
%		\textrm{(goto)} &g& \bnfis & \brk \bnfbar \continue\\
		\textrm{(Expressions)} &e& \bnfis & V \bnfbar v \bnfbar x \bnfbar r \bnfbar r.\mcall{m}{e} \bnfbar e;e \bnfbar r = e\\
		&&\bnfbar & \newo{C} \bnfbar \return e \bnfbar \switch{e}{l : e_l}_{l \in E} \\
		&&\bnfbar & \brk \lambda \bnfbar \continue \lambda \bnfbar \lambda: \while{e_1}{e_2}\\
		&&\bnfbar & \ifthenelse{e}{e}{e}
	\end{array}
\]

	Runtime Syntax:
\[
	\begin{array}{lrcl}
		& T & \bnfis & C[\set{T_i\ f_i}_{i \in I}]\\
		& v & \bnfis & \dots \bnfbar o\\
		& r & \bnfis & \dots \bnfbar o \\
		\textrm{(Context)} & \mathcal{E} &\bnfis& \hole \bnfbar \mathcal{E}; e \bnfbar r.m(\mathcal{E}) \bnfbar r = \mathcal{E}\\
				&&\bnfbar& \return{\mathcal{E}}
	\end{array}
\]

%	Proposal 1:
%
%	\begin{eqnarray*}
%		h \bnfis o = C[\vect{f} = \vec{\nul}] \bnfbar \epsilon\\
%	\end{eqnarray*}
%

%	Proposal 2:
%
	Operational Semantics:
%
	\begin{eqnarray*}
		h &\bnfis& h \cat o = C[\vect{f} = \vec{\nul}] \bnfbar \epsilon\\
		\sigma &\bnfis& \sigma \cat \phi \bnfbar \phi\\
		\phi &\bnfis& \set{\widetilde{x = o}}
	\end{eqnarray*}
%
\[
	\begin{array}{c}
		\tree{
			o\ \textrm{fresh} \quad C.\mathsf{fields} = \vect{f}
		}{
			(h; \sigma; \newo{C}) \red (h \cat o = C[\vect{f} = \vect{\nul}]; \sigma; o)
		}\\[4mm]
		\tree{
		}{
			(h; \sigma \cat \phi; \vdecl{T}{x}) \red (h; \sigma \cat \phi \cup \set{x = \nul}; \nul)
		}\\[4mm]
			(h; \sigma; v; e) \red (h; \sigma; e)
		\\[4mm]
		\tree{
			(h; \sigma; e) \red (h'; \sigma'; e')
		}{
			(h; \sigma; \econtext{E}{e}) \red (h'; \sigma'; \econtext{E}{e'})
		}
		\\
		\\
		\tree{
			(h; \sigma; e_1) \red^* (h''; \sigma''; \true) %\qquad (h''; \sigma''; e_2) \red (h'; \sigma'; e')
		}{
			(h; \sigma; \lambda: \while{\true}{e}) \red (h'; \sigma'; e_2;\lambda: \while{e_1}{e_2})
		}\\[4mm]

		\tree{
%			(h; \sigma; e_1) \red (h'; \sigma'; \false)
		}{
			(h; \sigma; \lambda: \while{\false}{e_2}) \red (h; \sigma; \false)
		}
	\end{array}
\]
%



%	Proposal 3:
%
%	\begin{eqnarray*}
%		\iota &\in& \mathbb{N}\\% \cup \set{0}\\
%		h &\bnfis& h \cat \iota: C[\widetilde{f \mapsto 0}] \bnfbar 0: \nul \\%\epsilon\\
%		\sigma &\bnfis& \sigma \cat \phi \bnfbar \phi\\
%		\phi &\bnfis& \set{\widetilde{o \mapsto \iota}}
%	\end{eqnarray*}
\end{document}
%%%
